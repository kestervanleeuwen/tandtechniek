<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qua Opdrachten</title>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/opdrachten.css">
    <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>
    <link href="http://fonts.cdnfonts.com/css/tisa-sans-pro" rel="stylesheet">
    <script type="text/javascript" src="/js/index.js" defer></script>

    </script>
</head>
<body>
<main>
    <div class="sidebar">
        <div class="logo-body">
            <div class="logo">
                <img src="/img/favicon.ico">
                <div class="logo-name">ua Tandtechniek</div>
            </div>
            <i class='bx bx-menu' id="menu"></i>
        </div>
        <ul class="nav-list">
            <li>
                <a href="index.html">
                    <i class='bx bx-home'></i>
                    <span class="sidebar-link">Home</span>
                </a>
                <span class="tooltip">Home</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bx-notepad'></i>
                    <span class="sidebar-link">Opdrachten</span>
                </a>
                <span class="tooltip">Opdrachten</span>
            </li>
            <li>
                <a href="opdrachten.html">
                    <i class='bx bx-archive'></i>
                    <span class="sidebar-link">Opdracht types</span>
                </a>
                <span class="tooltip">Opdracht types</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bx-user'></i>
                    <span class="sidebar-link">Klanten</span>
                </a>
                <span class="tooltip">Klanten</span>
            </li>
            <li>
                <a href="#">
                    <i class='bx bx-package' ></i>
                    <span class="sidebar-link">Voorraad</span>
                </a>
                <span class="tooltip">Voorraad</span>
            </li>
        </ul>
        <div class="profile-body">
            <div class="profile">
                <div class="person">
                    <div class="person-name">Kester van Leeuwen</div>
                    <div class="person-job">Senior Tandtechnicus</div>
                </div>
            </div>
            <button id="logoutButton"><i class="bx bx-log-out" id="log-out"></i></button>
        </div>
    </div>
    <div class="home-body">
        <h1>Opdrachten</h1>
        <div class="opdracht-container">
            <div class="newopdracht-div">
                <button onclick="window.location.href='/nieuwopdracht.html'" class="newopdracht">Nieuwe opdracht <i class='bx bxs-plus-circle'></i></button>
            </div>

            <div class="opdracht-body">
                <div class="finished-div">
                    <div class="title">Afgemaakte opdrachten</div>
                    <div class="finished-list">

                    </div>
                </div>
                <div class="todo-div">
                    <div class="title">Nieuwe opdrachten</div>
                    <div class="todo-list">

                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<script>
    if (!window.localStorage.getItem("auth")) {
        window.open("login.html", "_self");
    }

    const todoList = document.querySelector('.todo-list');
    const finishedList = document.querySelector('.finished-list');
    const list = document.createDocumentFragment();

    var fetchOptions = {
        method: 'GET',
        headers: {
            "Authorization": localStorage.getItem("auth"),
        }
    }

    fetch('http://localhost:8080/opdracht', fetchOptions)
    .then((res) => {
        return res.json();
    }).then((data) => {
        let openOpdrachten = data.filter((opdracht) => opdracht.status == 'open')
        let finishedOpdrachten = data.filter((opdracht) => opdracht.status == 'closed')

        finishedOpdrachten.forEach((opdracht) => {
            let button = document.createElement('BUTTON');
            let opdrachtNaam = document.createElement('span');

            opdrachtNaam.innerHTML = `ID: ${opdracht.opdrachtNummer}: ${opdracht.opdrachtNaam}`;

            button.appendChild(opdrachtNaam);
            finishedList.appendChild(button);

            button.addEventListener("click", () => {
                const urlParams = new URLSearchParams(window.location.search);
                urlParams.set("opdrachtNummer", opdracht.opdrachtNummer);
                window.open("opdracht.html?" + urlParams, "_self");
            });
        })

        openOpdrachten.forEach((opdracht) => {
            let button = document.createElement('BUTTON');
            let opdrachtNaam = document.createElement('span');

            opdrachtNaam.innerHTML = `ID: ${opdracht.opdrachtNummer}: ${opdracht.opdrachtNaam}`;

            button.appendChild(opdrachtNaam);
            todoList.appendChild(button);

            button.addEventListener("click", () => {
                const urlParams = new URLSearchParams(window.location.search);
                urlParams.set("opdrachtNummer", opdracht.opdrachtNummer);
                window.open("opdracht.html?" + urlParams, "_self");
            });
        })
    }).catch(function (e) {
        console.log(e);
    })

    document.getElementById('logoutButton').addEventListener("click", () => {
        localStorage.removeItem("auth");
        window.open("login.html", "_self");
    })
</script>
</body>
</html>